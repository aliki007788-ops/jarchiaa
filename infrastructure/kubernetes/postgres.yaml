apiVersion: v1
kind: PersistentVolumeClaim
metadata:
name: postgres-pvc
namespace: jarchia
spec:
accessModes:
- ReadWriteOnce
resources:
requests:
storage: 50Gi

apiVersion: apps/v1
kind: StatefulSet
metadata:
name: postgres
namespace: jarchia
spec:
serviceName: postgres
replicas: 1
selector:
matchLabels:
app: postgres
template:
metadata:
labels:
app: postgres
spec:
containers:
- name: postgres
image: postgis/postgis:15-3.4
env:
- name: POSTGRES_DB
value: jarchia
- name: POSTGRES_USER
valueFrom:
secretKeyRef:
name: jarchia-secrets
key: db-user
- name: POSTGRES_PASSWORD
valueFrom:
secretKeyRef:
name: jarchia-secrets
key: db-password
volumeMounts:
- name: postgres-data
mountPath: /var/lib/postgresql/data
volumeClaimTemplates:

metadata:
name: postgres-data
spec:
accessModes: ["ReadWriteOnce"]
resources:
requests:
storage: 50Gi


